<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graph Data</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        .tab {
            display: none;
        }

        .tab-button {
            padding: 10px;
            margin: 5px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: none;
            border-bottom: 2px solid transparent;
        }

        .tab-button.active {
            background-color: #ddd;
            border-bottom: 2px solid #007BFF;
        }

        .tab-content {
            padding: 20px;
        }
    </style>
</head>

<body>

    <h2>Interactive Gr√°ficos</h2>
    <div>
        <button class="tab-button active" onclick="showTab('decades')">Decades</button>
        <button class="tab-button" onclick="showTab('technicians_asb')">Technicians in ASB</button>
        <button class="tab-button" onclick="showTab('age_aas')">Average Age in AAS</button>
        <button class="tab-button" onclick="showTab('before_2010_aii')">AII Before 2010</button>
        <button class="tab-button" onclick="showTab('gender_uatp')">Gender in UATP</button>
        <button class="tab-button" onclick="showTab('interns_das')">Interns in DAS</button>
        <button class="tab-button" onclick="showTab('direction_membership')">Direction Membership</button>
    </div>

    <div id="decades" class="tab tab-content" style="display: block;"></div>
    <div id="technicians_asb" class="tab tab-content"></div>
    <div id="age_aas" class="tab tab-content"></div>
    <div id="before_2010_aii" class="tab tab-content"></div>
    <div id="gender_uatp" class="tab tab-content"></div>
    <div id="interns_das" class="tab tab-content"></div>
    <div id="direction_membership" class="tab tab-content"></div>

    <script>
        // Function to show the selected tab and hide others
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.style.display = 'none');
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => button.classList.remove('active'));
            document.getElementById(tabName).style.display = 'block';
            document.querySelector(`.tab-button[onclick="showTab('${tabName}')"]`).classList.add('active');
        }

        // Fetch and render the graphs
        function fetchAndRenderGraphs() {
            fetch("{% url 'chart_data_questions' %}")
                .then(response => response.json())
                .then(data => {
                    // Graph for Decades (highlight AFI born in 1970s)
                    const allDecadesData = Object.keys(data.decades).map(area => ({
                        x: Object.keys(data.decades[area]), // Decades
                        y: Object.values(data.decades[area]), // Number of technicians
                        name: area,
                        type: 'bar',
                        marker: {
                            color: area === 'AFI' ? '#ff7f0e' : '#c7c7c7', // Highlight AFI
                        }
                    }));
                    Plotly.newPlot('decades', allDecadesData, {
                        title: 'Technicians Born in Different Decades for All Areas',
                        barmode: 'group'
                    });

                    // Graph for Total Technicians in ASB (highlight ASB)
                    const asbTechniciansData = [{
                        x: Object.keys(data.total_technicians),
                        y: Object.values(data.total_technicians),
                        type: 'bar',
                        marker: {
                            color: Object.keys(data.total_technicians).map(area => area === 'ASB' ? '#2ca02c' : '#c7c7c7') // Highlight ASB
                        }
                    }];
                    Plotly.newPlot('technicians_asb', asbTechniciansData, {
                        title: 'Total Technicians per Area (Highlight ASB)',
                        barmode: 'group'
                    });

                    // Graph for Average Age in AAS (show all areas, highlight AAS)
                    const averageAgeData = [{
                        x: Object.keys(data.average_age),
                        y: Object.values(data.average_age),
                        type: 'bar',
                        marker: {
                            color: Object.keys(data.average_age).map(area => area === 'AAS' ? '#9467bd' : '#c7c7c7') // Highlight AAS
                        }
                    }];
                    Plotly.newPlot('age_aas', averageAgeData, {
                        title: 'Average Age per Area (Highlight AAS)',
                        barmode: 'group'
                    });

                    // Graph for AII Technicians before 2010 (show all areas, highlight AII)
                    const aiiBefore2010Data = [{
                        x: Object.keys(data.before_2010),
                        y: Object.values(data.before_2010),
                        type: 'bar',
                        marker: {
                            color: Object.keys(data.before_2010).map(area => area === 'AII' ? '#d62728' : '#c7c7c7') // Highlight AII
                        }
                    }];
                    Plotly.newPlot('before_2010_aii', aiiBefore2010Data, {
                        title: 'Technicians Joined Before 2010 (Highlight AII)',
                        barmode: 'group'
                    });

                    // Graph for Gender Distribution in UATP (show all areas, highlight UATP)
                    console.log(...Object.values(data.gender_distribution))
                    const genderData = Object.keys(data.gender_distribution).map(area =>
                    ({
                        x: Object.keys(data.gender_distribution[area]),
                        y: Object.values(data.gender_distribution[area]),
                        name: area,
                        type: 'bar',
                        marker: {
                            color: area === 'UATP' ? '#2ca02c' : '#c7c7c7' // Highlight UATP
                        }
                    }));
                    Plotly.newPlot('gender_uatp', genderData, {
                        title: 'Gender Distribution (Highlight UATP)',
                        barmode: 'group',
                        yaxis: {
                            tickvals: Array.from({length: Math.max(...Object.values(data.gender_distribution)) + 1}, (_, i) => i)
                        }
                    });

                    // Graph for Interns in DAS (show all areas, highlight DAS)
                    const dasInternsData = [{
                        x: Object.keys(data.interns),
                        y: Object.values(data.interns),
                        type: 'bar',
                        marker: {
                            color: Object.keys(data.interns).map(area => area === 'DAS' ? '#e377c2' : '#c7c7c7') // Highlight DAS
                        }
                    }];
                    Plotly.newPlot('interns_das', dasInternsData, {
                        title: 'Interns in Each Area (Highlight DAS)',
                        barmode: 'group',
                        yaxis: {
                            tickvals: Array.from({length: Math.max(...Object.values(data.interns)) + 1}, (_, i) => i)
                        }
                    });

                    // Graph for Direction Membership (when the members joined)
                    console.log(Array.from({length: Math.max(...Object.values(data.direction_membership)) + 1}, (_, i) => i))
                    const directionMembershipData = [{
                        x: Object.keys(data.direction_membership),
                        y: Object.values(data.direction_membership),
                        type: 'bar',
                        marker: {
                            color: '#1f77b4'
                        },
                    }];
                    Plotly.newPlot('direction_membership', directionMembershipData, {
                        title: 'When Direction Members Joined the Bank',
                        yaxis: {
                            tickvals: Array.from({length: Math.max(...Object.values(data.direction_membership)) + 1}, (_, i) => i)
                        }
                    });
                });
        }

        // Call the function on load and refresh every 30 seconds
        fetchAndRenderGraphs();
        setInterval(fetchAndRenderGraphs, 30000);
    </script>

</body>

</html>
